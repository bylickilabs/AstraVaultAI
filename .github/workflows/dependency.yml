name: ğŸ”’ AstraVault AI â€“ Dependency Audit

on:
  schedule:
    - cron: '0 */3 * * *'   # every 3 hours UTC
  workflow_dispatch:

jobs:
  audit:
    name: ğŸ§  Automated Vulnerability Audit
    runs-on: ubuntu-latest

    steps:
      # ---------------------------------------------------------
      # 1ï¸âƒ£ Checkout Repository
      # ---------------------------------------------------------
      - name: ğŸ§± Checkout Repository
        uses: actions/checkout@v4

      # ---------------------------------------------------------
      # 2ï¸âƒ£ Set up Python
      # ---------------------------------------------------------
      - name: âš™ï¸ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # ---------------------------------------------------------
      # 3ï¸âƒ£ Install pip-audit
      # ---------------------------------------------------------
      - name: ğŸ§© Install pip-audit
        run: |
          python -m pip install --upgrade pip
          pip install pip-audit

      # ---------------------------------------------------------
      # 4ï¸âƒ£ Run the vulnerability audit
      # ---------------------------------------------------------
      - name: ğŸ” Run vulnerability audit
        run: |
          echo ">>> Starting pip-audit vulnerability scan..."
          if [ -f "requirements.txt" ]; then
              pip-audit -r requirements.txt || echo "âš ï¸ Vulnerabilities detected."
          else
              echo "âš ï¸ No requirements.txt found â€“ skipping audit."
          fi

      # ---------------------------------------------------------
      # 5ï¸âƒ£ Completion summary
      # ---------------------------------------------------------
      - name: âœ… Audit Completed
        run: |
          echo "============================================================"
          echo "âœ… AstraVault AI â€“ Dependency Audit Completed Successfully"
          echo "ğŸ”’ BYLICKILABS â€“ Intelligence Systems & Communications"
          echo "ğŸ•’ Audit Frequency: Every 3 hours (UTC)"
          echo "============================================================"
