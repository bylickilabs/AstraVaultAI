name: üßæ AstraVault AI ‚Äì Repository Integrity Check

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  repository:
    name: üß± Repository Validation & Metadata Report
    runs-on: ubuntu-latest

    steps:
      # ---------------------------------------------------------
      # 1Ô∏è‚É£ Checkout Repository
      # ---------------------------------------------------------
      - name: üß± Checkout Repository
        uses: actions/checkout@v4

      # ---------------------------------------------------------
      # 2Ô∏è‚É£ Set up Python (for file inspection tools)
      # ---------------------------------------------------------
      - name: ‚öôÔ∏è Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      # ---------------------------------------------------------
      # 3Ô∏è‚É£ Validate critical project files
      # ---------------------------------------------------------
      - name: üß© Verify Repository Files
        run: |
          echo ">>> Checking for required documentation files..."
          REQUIRED_FILES=("README.md" "LICENSE" "SECURITY.md" "CONTRIBUTING.md" "requirements.txt")
          for file in "${REQUIRED_FILES[@]}"; do
            if [ -f "$file" ]; then
              echo "‚úÖ $file found."
            else
              echo "‚ùå Missing: $file"
              MISSING=true
            fi
          done
          if [ "$MISSING" = true ]; then
            echo "‚ö†Ô∏è One or more critical files are missing."
          else
            echo "‚úÖ All required repository files are present."
          fi

      # ---------------------------------------------------------
      # 4Ô∏è‚É£ Gather metadata and print summary
      # ---------------------------------------------------------
      - name: üß† Collect Repository Metadata
        run: |
          echo "============================================================"
          echo "üì¶ AstraVault AI ‚Äì Repository Summary"
          echo "============================================================"
          echo "üß≠ Repository: $GITHUB_REPOSITORY"
          echo "üîñ Branch: $GITHUB_REF_NAME"
          echo "üë§ Author: $GITHUB_ACTOR"
          echo "üïí Commit Timestamp: $(date)"
          echo "------------------------------------------------------------"
          echo "üîç Python Version:"
          python --version
          echo "------------------------------------------------------------"
          echo "üìÑ Files in Repository Root:"
          ls -1 | sed 's/^/   ‚Ä¢ /'
          echo "============================================================"

      # ---------------------------------------------------------
      # 5Ô∏è‚É£ Lint Markdown & YAML files
      # ---------------------------------------------------------
      - name: üßπ Validate Markdown & YAML
        run: |
          echo ">>> Installing linting tools..."
          pip install yamllint markdownlint-cli
          echo ">>> Running lint checks..."
          yamllint . || echo "‚ö†Ô∏è YAML warnings detected (non-critical)"
          markdownlint . || echo "‚ö†Ô∏è Markdown style warnings detected"

      # ---------------------------------------------------------
      # 6Ô∏è‚É£ Workflow Summary
      # ---------------------------------------------------------
      - name: ‚úÖ Repository Check Completed
        run: |
          echo "============================================================"
          echo "‚úÖ AstraVault AI ‚Äì Repository Integrity Check Completed"
          echo "üîí BYLICKILABS ‚Äì Intelligence Systems & Communications"
          echo "============================================================"
